.DEFAULT_GOAL := test
SRC_MODEL=../model/
INCLUDE=$(SRC_MODEL)
CFLAGS = -Wall  $(DEBUG) -I$(INCLUDE) -g -fprofile-arcs -ftest-coverage
LFLAGS = -llog4cplus -L $GTEST_HOME/lib -lgtest -lgtest_main -lpthread

TARGET_UTILVECTOR_TEST=UtilVectorTest
SOURCES_UTILVECTOR_TEST=$(SRC_MODEL)UtilVector.cc $(SRC_MODEL)GraphXY.cc 
SOURCES_UTILVECTOR_TEST+=UtilVectorTest.cc $(SRC_MODEL)DeletePointCommand.cc $(SRC_MODEL)GraphXYIterator.cpp

INCLUDE_FILES=$(SRC_MODEL)UtilVector.hpp $(SRC_MODEL)GraphXY.hpp

TARGET_GRAPHXY_ITERATOR_TEST=GraphXYIteratorTest
SOURCES_GRAPHXY_ITERATOR_TEST=GraphXYIteratorTest.cc 
SOURCES_GRAPHXY_ITERATOR_TEST+=$(SRC_MODEL)GraphXYIterator.cpp
SOURCES_GRAPHXY_ITERATOR_TEST+=$(SRC_MODEL)GraphXY.cc  GraphXYTest.cc DeletePointCommndTest.cc 
SOURCES_GRAPHXY_ITERATOR_TEST+=$(SRC_MODEL)DeletePointCommand.cc 
INCLUDE_FILES_GRAPHXY_ITERATOR_TEST=$(SRC_MODEL)GraphXYIterator.hpp


TARGET_PURGE_GRAPHXY_TEST=PurgeGraphXYTest
SOURCES_PURGE_GRAPHXY_TEST=PurgeGraphXYTest.cc $(SRC_MODEL)PurgeGraphXY.cc	$(SRC_MODEL)GraphXY.cc	
SOURCES_PURGE_GRAPHXY_TEST += $(SRC_MODEL)GraphXYIterator.cpp	

$(TARGET_UTILVECTOR_TEST): $(SOURCES_UTILVECTOR_TEST) $(INCLUDE_FILES)
	g++ $(CFLAGS) $(LFLAGS)  $(SOURCES_UTILVECTOR_TEST) -o $(TARGET_UTILVECTOR_TEST)

$(TARGET_GRAPHXY_ITERATOR_TEST): $(SOURCES_GRAPHXY_ITERATOR_TEST) $(INCLUDE_FILES_GRAPHXY_ITERATOR_TEST)
	g++ $(CFLAGS) $(LFLAGS) -L $GTEST_HOME/lib -lgtest -lgtest_main -lpthread $(SOURCES_GRAPHXY_ITERATOR_TEST) -o $(TARGET_GRAPHXY_ITERATOR_TEST)

$(TARGET_PURGE_GRAPHXY_TEST): $(SOURCES_PURGE_GRAPHXY_TEST) 
	g++ $(CFLAGS) $(LFLAGS) -L $GTEST_HOME/lib -lgtest -lgtest_main -lpthread $(SOURCES_PURGE_GRAPHXY_TEST) -o $(TARGET_PURGE_GRAPHXY_TEST)

valgrind_test:
	LD_LIBRARY_PATH=LD_LIBRARY_PATH:/usr/local/lib/ valgrind --error-exitcode=1 --leak-check=full --read-var-info=yes  ./$(TARGET_UTILVECTOR_TEST) 
	LD_LIBRARY_PATH=LD_LIBRARY_PATH:/usr/local/lib/ valgrind --error-exitcode=1 --leak-check=full --read-var-info=yes  ./$(TARGET_GRAPHXY_ITERATOR_TEST)
 	LD_LIBRARY_PATH=LD_LIBRARY_PATH:/usr/local/lib/ valgrind --error-exitcode=1 --leak-check=full --read-var-info=yes  ./$(TARGET_PURGE_GRAPHXY_TEST)

test: $(TARGET_UTILVECTOR_TEST) $(TARGET_GRAPHXY_ITERATOR_TEST) $(TARGET_PURGE_GRAPHXY_TEST)
	LD_LIBRARY_PATH=LD_LIBRARY_PATH:/usr/local/lib/ ./$(TARGET_UTILVECTOR_TEST)
	LD_LIBRARY_PATH=LD_LIBRARY_PATH:/usr/local/lib/ ./$(TARGET_GRAPHXY_ITERATOR_TEST)
	LD_LIBRARY_PATH=LD_LIBRARY_PATH:/usr/local/lib/ ./$(TARGET_PURGE_GRAPHXY_TEST)

test_iterator: $(TARGET_GRAPHXY_ITERATOR_TEST)
	LD_LIBRARY_PATH=LD_LIBRARY_PATH:/usr/local/lib/ ./$(TARGET_GRAPHXY_ITERATOR_TEST)

test_purge: $(TARGET_PURGE_GRAPHXY_TEST)
	LD_LIBRARY_PATH=LD_LIBRARY_PATH:/usr/local/lib/ ./$(TARGET_PURGE_GRAPHXY_TEST)	

clean:
	rm -Rf $(TARGET_UTILVECTOR_TEST)  $(TARGET_PURGE_GRAPHXY_TEST)	  $(TARGET_GRAPHXY_ITERATOR_TEST)

	rm -Rf *.o
	rm -Rf *.gcov
	rm -Rf *.gcda
	rm -Rf *.gcno
